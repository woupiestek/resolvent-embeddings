\documentclass[sort&compress,draft]{elsarticle}
\usepackage{amssymb, amsmath, amsthm}
\usepackage[all]{xy}
\usepackage{cite}
\usepackage{url}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\newcommand\hide[1]{}
\newcommand\key[1]{\emph{#1}\label{#1}}
\newcommand\cat\mathcal
\newcommand\set[1]{\left\{#1\right\}}
\newcommand\exlex{_\mathrm{ex/lex}}\newcommand\exreg{_\mathrm{ex/reg}}
\newcommand\of:
\newcommand\ri{^*}
\newcommand\id{\mathrm{id}}
\newcommand\dom{\mathrm{dom}}
\newcommand\cod{\mathrm{cod}}
\newcommand\di{_!}

\newcommand\Cat\mathsf
\newcommand\dual{^{op}}
\newcommand\Set{\Cat{Set}}
\newcommand\HA{\Cat{HA}}


\begin{document}
\begin{frontmatter}
\title{Resolvent embeddings}

\author[W. P. Stekelenburg]{Wouter Pieter Stekelenburg}
\address{Faculty of Mathematics, Informatics and Mechanics,
University of Warsaw,
Banacha 2,
02-097 Warszawa,
Poland}
\ead{w.p.stekelenburg@gmail.com}
\fntext[W. P. Stekelenburg]{Corresponding author; tel.: +31624543216}

\begin{abstract}
\end{abstract}

\begin{keyword}
\end{keyword}

%AMS 18A22

\end{frontmatter}


\section{Resolvent Embeddings}
As the title suggests this paper is about the following kind of functor.

\begin{definition} Let $F\of \cat C\to\cat D$ be an arbitrary functor. For each object $X$ of $\cat D$, a \key{resolution} is an object $Y$ in $\cat C$ together with a morphism $r:FY\to X$ with the following two properties.
\begin{enumerate} 
\item The morphism $r$ is a regular epimorphism.
\item For each morphism $f\of FZ\to X$ there is a $g\of Z\to Y$ such that $f=r\circ Fg$.
\[ \xymatrix{
& FY \ar[d]^{r} \\
FZ\ar[r]_f \ar@{.>}[ur]^{Fg} & X
}\]
\end{enumerate}
A functor $F:\cat C\to\cat D$ is \key{resolvent} if each object of $\cat D$ has a resolution. A \emph{resolvent embedding} is a resolvent functor that is also fully faithful.
\end{definition}

Resolvent embeddings are particularly interesting when they are also \emph{ex/reg completions}.

\begin{definition} A regular functor $F\of\cat C\to\cat D$ from a regular category $\cat C$ to an exact category $\cat D$ is an \key{ex/reg completion} of $\cat C$ if every regular functor $G\of \cat C\to\cat E$ to an exact category $\cat E$ factors through $F$ up to isomorphism in an up to isomorphism unique way.

A finite limit preserving functor $F\of\cat C\to\cat D$ from a category with finite limits $\cat C$ to an exact category $\cat D$ is an \key{ex/lex completion} of $\cat C$ if every finite limit preserving functor $G\of \cat C\to\cat E$ to an exact category factors through $F$ up to isomorphism in an up to isomorphism unique way.
\end{definition}\hide{It is clear that completions are fully faithful? How does this follow from the universal property?}

\begin{example} An ex/lex completion $F\of\cat C\to\cat C\exlex$ is a resolvent embedding, because it embeds $\cat C$ as the subcategory of projective objects. \hide{cite for both definitions and theorems} \end{example}


\begin{theorem} Let $F:\cat C\to\cat C\exreg$ be an ex/reg completion of a regular category $\cat C$, let $G\of \cat C \to \cat C\exlex$ be the ex/lex completion and let $H$ be one of the up to isomorphism unique functors $H\of\cat C\exlex \to \cat C\exreg$ that satisfy $HG\simeq F$. 
The following are equivalent.
\begin{enumerate}
\item $F$ is resolvent.
\item $H$ has a fully faithful right adjoint.
\item For each exact $\cat D$, each functor $K\of \cat C \to \cat D$ that preserves finite limits has a left Kan extension along $F$ that also preserves finite limits.
\end{enumerate}
\end{theorem}

\begin{proof} 
%1 -> 2
Assume 1. Lemma \ref{lex ex} shows that there is a finite limit preserving left Kan extension $F\di(G)$ of $G$ along $F$ such that $F\di(G)F\simeq G$. Since $G$ is fully faithful, so is $F\di(G)$. The universal property of $G$ extends the composed isomorphisms $G \simeq F\di(G)F\simeq F\di(G)HG$ to an isomorphism $\id_{\cat C\exlex}\simeq F\di(G)H$, where $\id_{\cat C\exlex}$ is the identity functor of $\cat C\exlex$, which serves as the unit of the adjunction $H \dashv F\di(G)$. Because the universal properties of $F$ are weaker then those of $G$, the isomorphisms $HF\di(G)F\simeq HG\simeq F$ only extend to a natural transformation $HF\di(G)\to \id_{\cat C\exlex}$ which serves as the counit of the same adjunction.

%2 -> 3
Assume 2. Composition with $G$ defines a functor $\Cat{Ex}(\cat C\exlex,\cat D)\to\Cat{Lex}(\cat C,\cat D)$ which is an equivalence of categories because $G$ is an ex/lex completion. Here $\Cat{Ex}$ is the 2-category of exact categories, regular functors and natural transformations, and $\Cat{Lex}$ the 2-category of categories with finite limits, functors that preserve finite limits and natural transformations. The 2-functor $\Cat{Ex}(-,\cat D)\of\Cat{Ex}\dual\to\Cat{Cat}$ preserves adjunctions. Here $\Cat{Cat}$ is the 2-category of arbitrary categories, functors and natural transformations. In the dual $\Cat{Ex}\dual$ right adjoints become left adjoints and that is how the left Kan extensions in 3 follow from 2.
\hide{Is this acceptable? Would it (not) be better to move everything to the 2-categorical level?}

%3 -> 1
Assume 3. Define $\cat E$ as follows. Objects are regular epimorphisms $FX\to Y$ in $\cat D$. A morphism $e\to e'$ is a morphism $f\of\cod(e)\to\cod(e')$
such that $f\circ e$ factors through $e'$. This category $\cat E$ is easily proved exact. Let $G\of \cat C\to\cat E$ map $X$ to $\id_{FX}$. This functor preserves finite limits. Any left Kan extension $F\di(G)$ sends each object $D$ of $\cat D$ to a resolvent embedding. Therefore $F$ is resolvent.

Since 1 implies 2 and 3, 2 implies 3 and 3 implies 1, all three statements are equivalent.
\end{proof}

Resolvent embeddings also play a role in topos theory.

\begin{definition} A \key{generic monomorphism} is a monomorphism each monomorphism is a pullback of. Let $f:X \to Y$ and $g\of V\to X$ be morphisms in a category $\cat C$. A \key{weakly dependent product} of $g$ along $f$ is a generic element (see definition \ref{generic element}) for the functor $\cat C/X(f\ri(-),g)\of (\cat C/Y)\dual\to\Set$.\end{definition}

\begin{theorem} Let $F:\cat C\to\cat C\exreg$ be the ex/reg completion of a regular category $\cat C$, then the following are equivalent.
\begin{enumerate}
\item $\cat C$ has \emph{weakly dependent products} and a \emph{generic monomorphism}. \hide{these need to be defined somewhere}
\item $\cat C\exreg$ is a topos and $F$ is resolvent. 
\end{enumerate}
\end{theorem}

\begin{proof}
Assume 1.

\hide{
The 'more direct proof' from the referee ignores resolvency of the regular completion, which is one of the two most important theorems of this paper. No wonder it can afford to be so simple. It must be an evil plot to bury this most remarkable result, possibly to claim it as his/her own at a later date.

Does the concept of a weakly complete equivalence relation make sense in regular categories?
Something extra that allows us to reduce any subobject of equivalent elements to a single element, possibly related to the generic monomorphisms?

Let $E(X,Y)\subseteq P(X)$ consist of equivalence classes, and look for the 'join operator' $\bigvee:E(X)\to X$.
}

Assume 2. Toposes have dependent products and subobject classifiers. Resolutions induce structures that have the same properties except for uniqueness. Therefore the subobject classifier is reduced to a generic monomorphism and the dependent products are reduced to weakly dependent products. Hence 1 follows from 2. %does this require a lemma?
\end{proof}

\hide{conclusion... }

\section{Ex/lex completions}
The goal of this section is to explain the connection between ex/lex completions and resolvent embeddings.

\begin{lemma} Let $F\of\cat C\to\cat D$ be a finite limit preserving resolvent embedding between categories with finite limits and let $G\of\cat C\to\cat E$ be an ex/lex completion. There is a finite limit preserving left Kan extension $F\di(G)$ of $G$ along $F$ such that $F\di(G)F\simeq G$.\label{lex ex}\end{lemma}

\newcommand\pser\mathbf
\begin{proof} For each object $X$ of $\cat D$, resolvency supplies a \emph{pseudo-equivalence relation} (see definition \ref{pseudo-equivalence relation}) $\pser(X)$ in $\cat C$ such that $X$ is the coequalizer of the image $F(\pser(X))$ by lemma \ref{induced psers}. Let $F\di(G)(X)$ be a coequalizer of $G(\pser(X))$. For each morphism $f\of X\to Y$ there is are morphism of pseudoequivalence relations $\pser(f)\of\pser(X)\to\pser(Y)$ such that $F\pser(f)$ commutes with $f$ and the coequalizers. Let $F\di(G)(f)$ be the morphism that $G\pser(f)$ induces between $F\di(G)(X)$ and $F\di(G)(Y)$.

That $F\di(G)$ is a functor that preserves finite limits for the following reasons. Because $F$ is resolvent, all the equations of morphisms in $\cat D$ that $F\di(G)$ must preserve are backed by equivalences of morphisms between pseudoequivalence relations in $\cat C$. By lemma \ref{equivalence implies equality} equivalence between morphisms of pseudoequivalence relation induce equalities between the coequalizers that form the image of $F\di(G)$.

The composition $F\di(G)F$ is isomorphic to $G$ because $G$ is an ex/lex completion and its universal property implies this.
\end{proof}


\begin{definition} In any category with finite limits $\cat C$, a parallel pair $f,g\of X\to Y$ is a \key{pseudo-equivalence relation}, if there are morphisms $r:Y\to X$, $s:X\to X$ and $t:X\times_YX \to X$--where $X\times_YX = \set{(x,y)\of X\times X|f(x)=g(y)}$ is the pullback of $f$ and $g$--such that the following equations hold.
\begin{align*}
f\circ r &=\id_Y & g\circ r &= \id_Y\\
f\circ s &= g & g\circ s &= f\circ s\\
f\circ t &= f\circ g\ri(f) & g\circ t &= g\circ f\ri(g)
\end{align*}

Here $f\ri(g)$ stand for the pullback of $g$ along $f$ and $\id_Y$ for the identity morphism of $Y$.

A \emph{morphism of pseudo-equivalence relations} $(f,g) \to (h,k)$ is a pair of morphisms $l_1\of \dom(f) \to \dom(h)$ and $l_0\of \cod(f) \to \cod(h)$ such that the following equations hold.
\begin{align*}
l_0\circ f &= h\circ l_1 & l_0\circ g &= k\circ l_1\\
\end{align*}

Here $\dom(f)$ is the domain of $f$ and $\cod(f)$ is the codomain of $f$.

Two such morphisms $l=(l_0,l_1),m=(m_0,m_1):(f,g) \to (h,k)$ are \emph{equivalent} is there is a morphism $n\of \cod f \to \dom h$ such that $h\circ n = l_0$ and $k\circ n = l_1$. Such an $n$ is an \emph{equivalence} of $l$ and $m$.
\end{definition}

\begin{remark} For a category with finite limits being exact means that every pseudoequivalence relation has a coequalizer, and that these coequalizers are stable under pullback.
\end{remark}




\hide{\begin{lemma} Let $F\of\cat C\to\cat D$ be a finite limit preserving resolvent embedding between categories with finite limits. For each exact $\cat E$ each finite limit preserving functor $G\of\cat C\to\cat E$ has a finite limit preserving left Kan extension $F\di(G)$ along $F$. Moreover, $F\di(G)F$ is naturally isomorphic to $G$.\label{resolvent to left}\end{lemma}

\hide{ It may be better to restrict this lemma to the special case where $G$ is the ex/lex completion of $\cat C$. }


\begin{proof}
For each object $D$ of $\cat D$ there is a pseudo-equivalence relation $\pser D$ in $\cat C$ such that a resolution of $D$ is the coequalizer of $F(\pser D)$by lemma \ref{induced psers}.
The functor $G$ sends $\pser D$ to a pseudo-equivalence relation $G(\pser D)$ in $\cat E$.
Let $F\di(G)(D)$ be the coequalizer of $G(\pser D)$, which is the image of $\pser D$ after application of $G$.

Each morphism $d\of D\to D'$ of $\cat D$ induces a morphism of pseudoequivalence relations $\pser{d}:\pser{D}\to\pser{D'}$ by lemma \ref{induced psers}.
The functor $G$ sends $\pser{d}$ to a morphism $G(\pser{d})\of G(\pser D)\to G(\pser{D'})$.
Let $F\di(G)(d)$ be the morphism that $G(\pser{d})$ induces between $F\di(G)(D)$ and $F\di(G)(D')$.

This mapping $F\di(G)$ is a finite lifting preserving functor for the following reasons. Because $F$ is resolvent, all the equations of morphisms in $\cat D$ that $F\di(G)$ must preserve are backed by equivalences of morphisms between pseudoequivalence relations in $\cat C$. By lemma \ref{equivalence implies equality} equivalence between morphisms of pseudoequivalence relation induce equalities between the coequalizers that form the image of $F\di(G)$.%more?

For each $H\of\cat D\to\cat E$ and each natural transformation $\eta\of G \to HF$ there is a unique $\eta'\of F\di(G)\to H$ such that $\eta'_{FX}=\eta_X$. It is the pointwise factorization of morphisms $GX_0\to HX$ through coequalizers of pseudo-equivalence relations.

For $D = FX$, $\id_{FX}$ is a resolution. It induces the trivial pseudoequivalence relation $\pser D = (\id_X,\id_X)$, and $\id_{GX}$ is a coequalizer of $GX$. Since the properties that must satisfy $F\di(G)$ make it unique up to isomorphism, $F\di(G)F$ must be naturally isomorphic to $G$. 
\end{proof}}

\begin{lemma} Let $F\of\cat C\to\cat D$ be a finite limit preserving resolvent embedding between categories with finite limits.
\begin{enumerate}
\item For each $D$ of $\cat D$ there is a pseudoequivalence relation $\pser D$ in $\cat C$ such that the resolution of $d$ is the coequalizer of $F(\pser D)$. 
\item For each morphism $d\of D\to D'$ there is a morphism $\pser d\of\pser D\to \pser{D'}$ that commutes with the resolutions of $D$ and $D'$ and $F(\pser d)$.
\end{enumerate}\label{induced psers}
\end{lemma}

\begin{proof} 
\begin{enumerate}
\item Let $d_0: FD_0\to D$ be a resolution of $D$, and let $d_1:FD_1 \to FD_0\times_DFD_0$ be a resolution of the domain of the pullback $d_0\ri(d_0)$. Since $F$ is an embedding, the morphisms $\pi_i\circ d_1\of FD_1\to FD_0$--where $\pi_i$ for $i=0,1$ are the projections of the pullback--are the image of a parallel pair of morphism $f,g\of D_1 \to D_0$ in $\cat C$.

An $r:D_0\to D_1$ that satisfies $f\circ r = g\circ r = \id_{D_0}$ comes from the diagonal $FD_0 \to FD_0\times_DFD_0$ because $F$ is resolvent. An $s\of D_1\to D_1$ that satisfies $f\circ s = g$ and $g\circ s = f$ comes from the swapping map $(x,y)\mapsto(y,x)\of FD_0\times_DFD_0\to FD_0\times_DFD_0$ for the same reason. Finally, a $t\of D_1\times_{D_0} D_1\to D_1$ that satisfies $f\circ t = f\circ g\ri(f)$ and $g\circ t = g\circ f\ri(g)$ comes from the map $(x,y) \mapsto (Ff(x),Fg(y)) \of FD_1\times_{FD_0} FD_1\to FD_0\times_DFD_0$.

\item Let $d \of D\to D'$ be a morphism of $\cat D$ and let $a\of FD_0\to D$ and $b\of FD'_0\to D'$ be resolutions. There is a $d_0\of D_0\to D'_0$ such that $b\circ F(d_0) = d\circ a$ because $F$ is resolvent. In turn, $(Fd_0,Fd_0)\of FD_0\times_DFD_0\to FD'_0\times_DFD'_0$ induces a map $d_1\to D_1\to D'_1$ that commutes with resolutions $a'\of FD_1\to FD_0\times_DFD_0$ and $b'\of FD'_1\to FD'_0\times_DFD'_0$. Because $F$ is fully faithful, $\pser d = (d_0,d_1)$ is a morphism of pseudoequivalence relations such that $F(\pser d)$ commutes with the resolutions and with $d$.
\end{enumerate}
\end{proof}

\begin{lemma} Let $f,g\of(a,b)\to(c,d)$ be equivalent morphisms of pseudo-e\-qui\-va\-len\-ce relations in an exact category. Both induce the same morphism between the coequalizers. \label{equivalence implies equality} \end{lemma}

\begin{proof} An equivalence $h$ between $f$ and $g$ factors the pair $(f_0,g_0)$ through $c$ and $d$. Therefore the coequalizer $e$ of $c$ and $d$ must satisfy $e\circ f=e\circ g$. This is sufficient, since the induced morphisms are the factorizations of $e \circ f$ and $e\circ g$ though the coequalizer of $a$ and $b$.
\end{proof}


\hide{\begin{lemma} Let $F\of\cat C\to\cat D$ be a finite limit preserving fully faithful between categories with finite limits and let $\cat D$ be exact. If for each exact $\cat E$ each finite limit preserving functor $G\of\cat C\to\cat E$ has a finite limit preserving left Kan extension $F\di(G)$ along $F$ then $F$ is resolvent. \label{left to resolvent}\end{lemma}

\begin{proof} Define $\cat E$ as follows. Objects are regular epimorphisms $FX\to Y$ in $\cat D$. A morphism $e\to e'$ is a morphism $f\of\cod(e)\to\cod(e')$
such that $f\circ e$ factors through $e'$. This category $\cat E$ is easily proved exact. Let $G\of \cat C\to\cat E$ map $X$ to $\id_{FX}$. This functor preserves finite limits. Any left Kan extension $F\di(G)$ sends each object $D$ of $\cat D$ to a resolvent embedding. Therefore $F$ is resolvent.
\end{proof}}

\hide{ The intuition is equational and essentially algebraic logic. Finite limit preserving functors preserve these.}

\section{Resolutions}
\newcommand\sub{\mathrm{sub}}
\newcommand\tuple[1]{\langle #1 \rangle}
One construction for the ex/reg completion takes binary relations as object and functions. This section show how to construct resolutions for these in the presence of weak exponentials and generic monomorphisms.

\begin{definition} Let $\cat C$ be a regular category. Define $\cat C\exreg$ as follows. An object of $\cat C\exreg$ is a pair $\tuple{X,e\of \sub(X\times X)}$ where $X$ is an object of $\cat C$ $e$ is an \key{equivalence relation}, i.e.\ a reflexive, symmetric and transitive binary relation on $X$. A morphism $(X,e_X)\to(Y,e_Y)$ is a \key{functional relation}, i.e.\ a binary relation $f\in \sub(X\times Y)$ that satisfies the following equations of subobjects for all $x,x'\of X$ and $y,y'$ of $Y$.
\begin{align*}
\exists x'\of X,y'\of Y.e_X(x,x')\land f(x',y')\land e_Y(y',y) &\leq f(x,y) \\
\top &\leq \exists y\of Y.f(x,y) \\
f(x,y)\land f(x,y') &\leq e_Y(y,y')
\end{align*} %closure under $e_Y$ guarantees uniqueness
Functional relations compose as follows.
\[ (f \circ g)(x,y) = \exists z\of \dom(f).f(z,y)\land g(x,z) \]
The identity functional relation of $(X,e)$ is $e$.
\end{definition}

\begin{lemma} Let $\cat C$ be a regular category with weak dependent products and a generic monomorphism.
Let $\Delta\of \cat C\to\cat C\exreg$ be the functor that satisfies. 
\begin{align*}
\Delta(X) &= (X,\set{\tuple{x,y}\of X\times X| x=y})\\
\Delta(f) &= \set{\tuple{x,y}\of X\times Y|f(x)=y}
\end{align*}
The functor $\Delta$ is a resolvent embedding.
\end{lemma}

\begin{proof} The functor $\Delta$ is fully faithful. A functional relation between $\Delta X$ and $\Delta Y$ defines a morphism $X\to Y$ because $\cat C$ is a regular category.

The generic monomorphism and weak dependent product together induce a generic element $\cat C(\Delta(-),(X,e))$, which is a regular epimorphism and hence a resolution.%how?
The object $S(X,e)$ is a subobject of the \emph{weak power object} $P(X)$, that consist of equivalence classes of $e$. %def
\hide{which we construct how? 

Image of:
 \[ \set{ \xi\of P(X)| \exists x\of X.\forall y\of Y. e(x,y) \iff y\in \xi }\] 

The object of inhabited subobjects $P(X)$ comes from the epi-mono factorization of $X\times P(X) \to P(X)$

$\cat C$ is Heyting thanks to the weak dependent products. Why not use that?

The morphism $\forall_f$ takes image of the weak dependent product along $f\of X\to Y$.
}


\end{proof}


\hide{ define equivalence relations for power objects separately. }

\section{Triposes}
Triposes generalize locales as structures to form toposes over. They are involved in the construction of elementary toposes that are not Grothendieck.

\begin{definition}
For a functor $F\of\cat C\to\Set$ a \key{generic element} is a pair $(X,x\in F(X))$ such that for each pair $(Y,y\in F(Y))$ there are $f\of X\to Y$ such that $y = F(f)(x)$. \hide{we can probably recycle this concept dozens of times, in particular as part of the definition of resolvent.}
\end{definition}

\begin{example} For a functor $F\of \cat C\to\cat D$ a resolution for an object $Y$ is a generic element of the functor $\cat C(F(-),Y)$. \end{example}

\begin{example} A generic monomorphism in a category $\cat C$ with pullbacks is a monomorphism for which the subobject that consists of isomorphic monomorphisms is a generic element for the functor that sends objects to their sets of subobjects, and morphisms to their inverse image maps.\end{example}

\begin{definition}
Let $\Cat{HA}$ be the category of Heyting algebras and morphisms of Heyting algebras that have both adjoints and let $U\of\Cat{HA}\to \Set$ be the underlying set functor. For each category $\cat C$ with finite products, a \key{tripos} is a functor $T\of\cat C\dual\to \Cat{HA}$ that also satisfies the following.

\begin{enumerate} 
\item The functor $U(T(X\times -))$ has a generic element for each $X$ of $\cat C$.
\item The adjoints $\exists_f\dashv Tf \dashv \forall_f$ commute with products, i.e. for all $f\of A\to B$ and all $g\of C\to D$,
\[ \xymatrix{
T(A\times D) \ar[rr]^{T(\id_A\times g)} \ar[d]_{\exists_{f\times \id_D}}&& T(A\times C)\ar[d]^{\exists_{f\times \id_C}}\\
T(B\times D) \ar[rr]_{T(\id_B\times g)} && T(B\times C)
}\] 
\end{enumerate}
\end{definition}
\end{document}


